<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pakistan Air Quality Initiative (PAQI)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Montserrat:wght@400;600;700&family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Design System --- */
        :root {
            --color-primary-blue: #003366;
            --color-secondary-blue: #0ea5e9;
            --color-background-light: #f9fafb;
            --color-background-dark: #1E2A3A;
            --color-text-dark: #333D4A;
            --color-text-light: #FFFFFF;
            --color-border: #DDE1E7;
            
            /* AQI Colors */
            --aqi-good: #22c55e;
            --aqi-moderate: #facc15;
            --aqi-usg: #f97316;
            --aqi-unhealthy: #ef4444;
            --aqi-very-unhealthy: #a855f7;
            --aqi-hazardous: #7e22ce;

            /* Mapping city colors */
            --color-lahore: #D94743;
            --color-karachi: #F49F0A;
            --color-peshawar: #5E3C99;
            --color-islamabad: #3153A5;
            
            --font-main: 'Poppins', sans-serif;
            --font-heading: 'Montserrat', sans-serif;
            --font-mono: 'Roboto Mono', monospace;
            --transition-curve: cubic-bezier(0.25, 1, 0.5, 1);
            --shadow-subtle: 0 5px 15px rgba(45, 57, 65, 0.05);
            --shadow-lifted: 0 15px 35px rgba(45, 57, 65, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: var(--font-main);
            background-color: var(--color-text-light);
            color: var(--color-text-dark);
            -webkit-font-smoothing: antialiased;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-heading);
            letter-spacing: -0.02em;
            font-weight: 700;
            color: var(--color-primary-blue);
        }

        p {
            font-family: var(--font-main);
            letter-spacing: 0em;
            font-weight: normal;
            color: var(--color-text-dark);
        }

        .container { width: 90%; max-width: 1200px; margin: 0 auto; padding: 100px 0; }
        .section-headline { font-size: clamp(1.5rem, 6vw, 3rem); max-width: 800px; margin: 0 auto 60px auto; text-align: center; font-weight: 500;}

        .animate-on-scroll { opacity: 0; transform: translateY(40px); transition: opacity 1s var(--transition-curve), transform 1s var(--transition-curve); }
        .animate-on-scroll.is-visible { opacity: 1; transform: translateY(0); }
        .delay-1 { transition-delay: 0.1s; } .delay-2 { transition-delay: 0.2s; } .delay-3 { transition-delay: 0.3s; }

/* --- Sticky Header --- */
        .site-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 2rem 0;
            transition: padding 0.5s ease, box-shadow 0.5s ease, background-color 0.5s ease, backdrop-filter 0.5s ease;
        }

        .header-scrolled {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-subtle);
            padding: 0.5rem 0;
        }

        .header-container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 0.2px solid rgba(255,255,255,0.3);
            padding-bottom: 2rem;
            transition: border-bottom 0.3s ease, padding-bottom 0.5s ease;
            position: relative; /* Context for AQI widget */
        }

        .header-scrolled .header-container {
            border-bottom-color: transparent;
            padding-bottom: 0;
        }

        .header-logo { display: flex; align-items: center; gap: 0.5rem; text-decoration: none; }
        .header-logo-icon { height: 2.5rem; width: 2.5rem; transition: all 0.5s ease; }
        .header-logo-text { font-size: 1.2rem; font-weight: 500; color: var(--color-text-light); transition: color 0.3s; }
        .header-scrolled .header-logo-text { color: var(--color-primary-blue); }
        .header-scrolled .header-logo-icon { height: 2rem; width: 2rem; }
        
        .header-nav { display: none; }
        @media (min-width: 768px) { 
            .header-nav { display: flex; align-items: center; gap: 2.5rem; } 
        }
        
        .header-nav-link { color: var(--color-text-light); text-decoration: none; font-weight: 500; transition: color 0.3s; }
        .header-scrolled .header-nav-link { color: var(--color-primary-blue); }
        .header-nav-link:hover { color: var(--color-secondary-blue); }
        
        .header-cta { display: none; }
        @media (min-width: 768px) { 
            .header-cta { 
                display: block; background-color: rgba(255,255,255,0.1); color: var(--color-text-light); border: 1px solid rgba(255,255,255,0.5);
                padding: 0.6rem 1.5rem; border-radius: 100px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; } 
            .header-scrolled .header-cta { background-color: var(--color-primary-blue); color: white; border-color: var(--color-primary-blue); }
            .header-cta:hover { background-color: var(--color-text-light); color: var(--color-primary-blue); border-color: var(--color-text-light); transform: scale(1.05) translateY(-2px); box-shadow: var(--shadow-lifted); }
        }
        
        .mobile-menu-button { display: block; background: none; border: none; cursor: pointer; padding: 0; color: var(--color-text-light); transition: color 0.3s; z-index: 1001;}
        .header-scrolled .mobile-menu-button { color: var(--color-primary-blue); }
        .mobile-menu-icon { width: 1.75rem; height: 1.75rem; }
        @media (min-width: 768px) { .mobile-menu-button { display: none; } }
        
        .mobile-menu { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: white; z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; transform: translateY(-100%); transition: transform 0.5s ease-in-out; }
        .mobile-menu.is-open { transform: translateY(0); }
        .mobile-menu a { display: block; padding: 1rem; font-size: 1.5rem; color: var(--color-primary-blue); text-decoration: none; font-weight: 600; opacity: 0; transform: translateY(20px); transition: opacity 0.3s ease, transform 0.3s ease; }
        .mobile-menu.is-open a { opacity: 1; transform: translateY(0); }
        .mobile-menu.is-open a:nth-child(1) { transition-delay: 0.2s; }
        .mobile-menu.is-open a:nth-child(2) { transition-delay: 0.25s; }
        .mobile-menu.is-open a:nth-child(3) { transition-delay: 0.3s; }
        .mobile-menu.is-open a:nth-child(4) { transition-delay: 0.35s; }
        .mobile-menu.is-open a:nth-child(5) { transition-delay: 0.4s; }
        .mobile-menu.is-open a:nth-child(6) { transition-delay: 0.45s; }

/* --- Hero Section --- */
        .hero-section { height: 100vh; position: relative; overflow: hidden; display: flex; flex-direction: column; justify-content: center; align-items: flex-start; padding: 0 5%; }
        .hero-slide-container { position: absolute; inset: 0; }
        .hero-slide { position: absolute; inset: 0; background-size: cover; background-position: center; opacity: 0; z-index: 0; transform: scale(1.05); transition: opacity 2s ease-in-out, transform 10s linear; }
        .hero-slide.active { opacity: 1; z-index: 1; transform: scale(1.15); }
        .hero-overlay { position: absolute; inset: 0; background-color: rgba(0, 20, 40, 0.5); z-index: 1; }
        .hero-content { position: relative; z-index: 10; width: 90%; max-width: 1200px; text-align: left; }
        .hero-text-container { max-width: 650px; }
        @media (min-width: 768px) { .hero-section { align-items: center; } }
        .hero-content h1 { font-size: clamp(2.5rem, 8vw, 5rem); color: var(--color-text-light); text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .hero-content p { font-size: clamp(1rem, 3vw, 1.25rem); color: var(--color-text-light); opacity: 0.9; max-width: 550px; margin: 1rem 0 2rem 0; }
        .hero-content .cta-button { text-decoration: none; color: var(--color-text-light); font-weight: 600; display: inline-block; transition: transform 0.3s ease; }
        .hero-content .cta-button:hover { transform: translateX(5px); }
        .hero-nav-links { position: absolute; bottom: 3rem; left: 50%; transform: translateX(-50%); z-index: 10; width: 90%; max-width: 1200px; display: flex; overflow-x: auto; -webkit-overflow-scrolling: touch; white-space: nowrap; padding-bottom: 1rem; }
        .hero-nav-links a { display: inline-block; flex-shrink: 0; padding-bottom: 0.75rem; color: rgba(255, 255, 255, 0.8); text-decoration: none; border-bottom: 2px solid rgba(255, 255, 255, 0.3); transition: all 0.3s; margin-right: 2rem; font-weight: 500; }
        .hero-nav-links::-webkit-scrollbar { display: none; }
        .hero-nav-links a:hover { color: white; border-bottom-color: var(--color-secondary-blue); transform: translateY(-2px); }
        @media (min-width: 768px) { 
            .hero-nav-links { overflow: visible; white-space: normal; display: grid; grid-template-columns: repeat(4, 1fr); gap: 2rem; }
            .hero-nav-links a { margin-right: 0; }
        }

/* --- AQI Widget --- */
        .aqi-widget {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 1.5rem;
            z-index: 990;
            background: rgba(40, 40, 40, 0.2);
            backdrop-filter: blur(10px);
            color: #FFFFFF;
            padding: 0.75rem 1.5rem;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 1.2rem;
            transform-origin: top right;
            will-change: transform;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        .aqi-text-wrapper, .aqi-title { transition: opacity 0.2s ease-out, transform 0.3s ease-out; }
        .aqi-value { transition: font-size 0.4s ease-in-out; }
        .aqi-widget.is-collapsed {
            width: 85px; height: 85px; border-radius: 50%;
            padding: 0; gap: 0; justify-content: center;
        }
        .aqi-widget.is-collapsed .aqi-title,
        .aqi-widget.is-collapsed .aqi-text-wrapper {
            opacity: 0; transform: scale(0.5); pointer-events: none; position: absolute;
        }
        .aqi-widget.is-collapsed .aqi-value { font-size: 2.5rem; }
        .aqi-text-wrapper { display: flex; flex-direction: column; align-items: flex-start; }
        .aqi-title { font-size: 0.9rem; font-weight: 500; opacity: 0.8; }
        .aqi-value { font-size: 2rem; font-weight: 700; font-family: var(--font-mono); }
        .aqi-category { font-size: 0.8rem; font-weight: 600; text-transform: uppercase; }
        .aqi-city { font-size: 0.75rem; opacity: 0.8; }
        .aqi-good { color: var(--aqi-good); } .aqi-moderate { color: var(--aqi-moderate); } .aqi-usg { color: var(--aqi-usg); } .aqi-unhealthy { color: var(--aqi-unhealthy); } .aqi-very-unhealthy { color: var(--aqi-very-unhealthy); } .aqi-hazardous { color: var(--aqi-hazardous); }
        @media (max-width: 767px) {
            .aqi-widget { position: fixed; top: auto; bottom: 1rem; right: 1rem; transform: scale(0.9); margin-top: 0; }
            .aqi-widget.is-collapsed { bottom: 1rem; right: 1rem; }
        }

/* --- Impact Section --- */
        .impact-item-number { font-family: var(--font-mono); }

/* --- Chart Section --- */
        .dataviz-section { overflow: hidden; background: var(--color-background-light); }
        .chart-grid { display: flex; flex-wrap: wrap; align-items: flex-start; }
        .chart-header, .chart-container { flex: 1 1 50%; }
        .chart-container { min-width: 0; } /* Flexbox shrink fix */
        .chart-legend { display: flex; flex-wrap: wrap; gap: 1rem 1.5rem; margin-top: 2rem; }
        .legend-item { display: flex; align-items: center; cursor: pointer; transition: opacity 0.3s; }
        .legend-item.is-dimmed { opacity: 0.3; }
        .legend-color { width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        
        .chart-svg { display: block; width: 100%; height: auto; overflow: visible; }
        .y-axis .tick line { stroke: var(--color-border); }
        .y-axis .tick:first-of-type line { stroke-dasharray: 4 4; }
        .y-axis .domain { display: none; }
        .chart-svg .data-line { fill: none; stroke-width: 3; stroke-linecap: round; stroke-linejoin: round; transition: opacity 0.4s; }
        .chart-svg .data-line.is-dimmed { opacity: 0.15; }
        @media (max-width: 767px) {
            .chart-grid { flex-direction: column; }
            .chart-svg-container { overflow-x: auto; -webkit-overflow-scrolling: touch; padding-bottom: 15px; width: 100vw; margin-left: -5vw; }
            .chart-svg { width: 800px; height: 550px; }
        }

/* --- Footer --- */
        .site-footer { background: var(--color-background-dark); color: rgba(255, 255, 255, 0.7); padding: 0; }
        .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 3rem; }
        .footer-col h4 { color: white; margin-bottom: 1.5rem; }
        .footer-col ul { list-style: none; }
        .footer-col ul li { margin-bottom: 0.75rem; }
        .footer-col a { text-decoration: none; color: rgba(255, 255, 255, 0.7); }
        .footer-socials { display: flex; gap: 1.5rem; margin-top: 1.5rem; }
        .footer-socials svg { width: 24px; height: 24px; transition: color 0.3s ease, transform 0.3s ease; }
        .footer-socials a:hover svg { color: white; transform: scale(1.1); }
        .footer-subscribe-form { display: flex; margin-top: 1rem; }
        .footer-subscribe-form input { width: 100%; border: 1px solid rgba(255,255,255,0.2); background: transparent; padding: 0.75rem; border-radius: 6px 0 0 6px; color: white; }
        .footer-subscribe-form button { border: none; background: var(--color-secondary-blue); color: white; padding: 0.75rem 1.25rem; border-radius: 0 6px 6px 0; cursor: pointer; font-weight: 600; }
        .footer-bottom { margin-top: 4rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.2); text-align: center; font-size: 0.9rem; }
        
/* --- ENHANCEMENT: Reactive & Aesthetic Styles --- */
        .hero-section::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle 400px at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(14, 165, 233, 0.1), transparent 80%);
            z-index: 2; pointer-events: none; transition: background 0.2s ease-out;
        }
        .header-nav-link, .footer-col ul a { position: relative; padding-bottom: 5px; }
        .header-nav-link::after, .footer-col ul a::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px;
            background-color: var(--color-secondary-blue); transform: scaleX(0);
            transform-origin: left; transition: transform 0.4s var(--transition-curve);
        }
        .header-nav-link:hover::after, .footer-col ul a:hover::after { transform: scaleX(1); }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>

    <header class="site-header" id="main-header">
        <div class="header-container">
            <a href="#" class="header-logo">
                <img class="header-logo-icon" src="/utils/logo.png" alt="Logo" />
                <span class="header-logo-text">Pakistan Air Quality Initiative</span>
            </a>
            <nav class="header-nav">
                <a href="#impact" class="header-nav-link">Impact</a>
                <a href="#map" class="header-nav-link">Map</a>
                <a href="#chart" class="header-nav-link">Data</a>
                <a href="#blog" class="header-nav-link">Our Insights</a>
                <a href="#team" class="header-nav-link">Our Team</a>
            </nav>
            <a href="#footer" class="header-cta">Let's Chat</a>
            <button id="mobile-menu-button" class="mobile-menu-button" aria-label="Toggle menu">
                <svg class="mobile-menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            <div class="aqi-widget" id="aqi-widget">
                <div class="aqi-title">AQI</div>
                <div class="aqi-value" id="aqi-value">...</div>
                <div class="aqi-text-wrapper">
                    <div class="aqi-category" id="aqi-category">Fetching</div>
                    <div class="aqi-city" id="aqi-city">...</div>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="mobile-menu"></div>
    </header>

    <main>
        <section id="hero" class="hero-section">
            <div class="hero-slide-container">
                <div id="slide-1" class="hero-slide active" style="background-image: url('/utils/pic1.png');"></div>
                <div id="slide-2" class="hero-slide" style="background-image: url('/utils/pic2.png');"></div>
                <div id="slide-3" class="hero-slide" style="background-image: url('/utils/pic3.jpeg');"></div>
                <div id="slide-4" class="hero-slide" style="background-image: url('/utils/pic4.jpg');"></div>
            </div>
            <div class="hero-overlay"></div>
            <div id="hero-text-content" class="hero-content">
                <div class="hero-text-container">
                    <h1>Clearing the Air for a Healthier Pakistan</h1>
                    <p>Air pollution is the nation's leading environmental threat. We are dedicated to providing the data and tools needed to drive change.</p>
                    <a href="#impact" class="cta-button">Learn About The Crisis &rarr;</a>
                </div>
            </div>
             <div class="hero-nav-links">
                <a href="#impact" class="hero-nav-link">Our Impact</a>
                <a href="#map" class="hero-nav-link">Interactive Map</a>
                <a href="#chart" class="hero-nav-link">Latest Data</a>
                <a href="#partners" class="hero-nav-link">Our Partners</a>
            </div>
        </section>

        <section id="impact" class="impact-section container">
            <h2 class="section-headline animate-on-scroll">Our Data-Driven Impact</h2>
            <div class="impact-grid">
                <div class="impact-item animate-on-scroll">
                    <div class="impact-item-number">150+</div>
                    <p class="impact-item-text">Monitoring Stations</p>
                </div>
                <div class="impact-item animate-on-scroll delay-1">
                    <div class="impact-item-number">2M+</div>
                    <p class="impact-item-text">People Reached</p>
                </div>
                <div class="impact-item animate-on-scroll delay-2">
                    <div class="impact-item-number">7.5K+</div>
                    <p class="impact-item-text">Social Media Followers</p>
                </div>
            </div>
        </section>

        <section id="partners" class="partners-section">
            <div class="container" style="padding-top: 0; padding-bottom: 0;">
                <h2 class="section-headline animate-on-scroll">Stronger Together</h2>
                <p class="animate-on-scroll" style="max-width: 600px; margin: -30px auto 60px auto; text-align: center;">We collaborate with leading organizations to maximize our impact and drive systemic change.</p>
                <div class="partners-slider">
                    <div class="slide-track">
                        <div class="slide"><img class="partner-logo" src="/utils/iqair.png" alt="IQAir" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/breathepak.png" alt="Breathe Pakistan" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/lums.png" alt="LUMS" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/lei.png" alt="LEI" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/uol.png" alt="University of Lahore" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/wwf.png" alt="WWF" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/umt.png" alt="UMT" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/iqair.png" alt="IQAir" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/breathepak.png" alt="Breathe Pakistan" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/lums.png" alt="LUMS" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/lei.png" alt="LEI" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/uol.png" alt="University of Lahore" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/wwf.png" alt="WWF" /></div>
                        <div class="slide"><img class="partner-logo" src="/utils/umt.png" alt="UMT" /></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="map" class="map-section">
            <div class="container">
                <div class="map-grid">
                    <div class="map-legend animate-on-scroll">
                        <h2 class="section-headline" style="text-align: left; color: white; margin: 0 0 1rem 0;">Real-Time Pollution Map</h2>
                        <p>Our network provides a live snapshot of the air quality in major urban centers. Explore the map to see the current PM2.5 levels.</p>
                        <div class="map-legend-items">
                            <div class="legend-item"><span class="legend-color-box" style="background-color: var(--aqi-good);"></span> Good</div>
                            <div class="legend-item"><span class="legend-color-box" style="background-color: var(--aqi-moderate);"></span> Moderate</div>
                            <div class="legend-item"><span class="legend-color-box" style="background-color: var(--aqi-usg);"></span> Unhealthy (SG)</div>
                            <div class="legend-item"><span class="legend-color-box" style="background-color: var(--aqi-unhealthy);"></span> Unhealthy</div>
                        </div>
                    </div>
                    <div class="map-container animate-on-scroll delay-1">
                        <img src="/utils/pak.png" class="map-image" alt="Map of Pakistan with AQI hotspots">
                        <div id="map-interactive-layer"></div>
                        <div id="map-tooltip" class="map-tooltip"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="chart" class="dataviz-section">
            <div class="container">
                <div class="chart-grid">
                    <div class="chart-header animate-on-scroll">
                        <h2 class="section-headline" style="text-align: left; margin: 0 0 1rem 0;">A Decade of Data</h2>
                        <p>Our network has chronicled the air quality crisis across Pakistan. While yearly fluctuations exist, the trend is clear: annual pollution levels remain dangerously high, consistently exceeding WHO safe limits.</p>
                        <div id="chart-legend" class="chart-legend"></div>
                    </div>
                    <div class="chart-container animate-on-scroll delay-1">
                        <div class="chart-svg-container">
                            <svg id="timeline-chart" class="chart-svg" viewBox="0 0 800 450"></svg>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="blog" class="blog-section container">
            <h2 class="section-headline animate-on-scroll">Our Latest Insights</h2>
            <div class="blog-grid">
                <a href="#" class="blog-card animate-on-scroll">
                    <div class="blog-card-image-wrapper"><img src="/utils/airpurifier.jpg" alt="Air purifier" class="blog-card-image"></div>
                    <div class="blog-card-content">
                        <h3>How to Choose the Right Air Purifier</h3>
                        <p>A practical guide to understanding HEPA filters, CADR ratings, and finding the perfect device for your space.</p>
                        <span class="blog-card-link">Read More &rarr;</span>
                    </div>
                </a>
                <a href="#" class="blog-card animate-on-scroll delay-1">
                    <div class="blog-card-image-wrapper"><img src="/utils/traffic.jpg" alt="Traffic in a city" class="blog-card-image"></div>
                    <div class="blog-card-content">
                        <h3>Policy on Vehicular Emissions</h3>
                        <p>Our latest recommendations for the government to tackle traffic pollution, one of the largest sources of smog.</p>
                        <span class="blog-card-link">Read More &rarr;</span>
                    </div>
                </a>
                <a href="#" class="blog-card animate-on-scroll delay-2">
                    <div class="blog-card-image-wrapper"><img src="/utils/community.jpg" alt="Community meeting" class="blog-card-image"></div>
                    <div class="blog-card-content">
                        <h3>Community Spotlight: Citizens Fighting Back</h3>
                        <p>How a neighborhood used our data to advocate for green spaces and reduce local industrial pollution.</p>
                        <span class="blog-card-link">Read More &rarr;</span>
                    </div>
                </a>
            </div>
        </section>

        <section id="team" class="team-section container">
            <h2 class="section-headline animate-on-scroll">The People Behind the Data</h2>
            <div class="team-grid">
                <div class="team-card animate-on-scroll"><img src="/utils/Abid.jpeg" alt="Abid" class="team-card-image"><h4>Abid Omar</h4><p>Founder & Director</p></div>
                <div class="team-card animate-on-scroll delay-1"><img src="/utils/Dawar.jpg" alt="Dawar Butt" class="team-card-image"><h4>Dawar Butt</h4><p>Chief Executive Officer</p></div>
                <div class="team-card animate-on-scroll delay-2"><img src="/utils/Mahad.jpeg" alt="Mahad Naveed" class="team-card-image"><h4>Mahad Naveed</h4><p>Lead Data Scientist</p></div>
                <div class="team-card animate-on-scroll delay-3"><img src="https://placehold.co/200x200/e2e8f0/334155?text=MS" alt="Mariam Shah" class="team-card-image"><h4>Mariam Shah</h4><p>Communications Lead</p></div>
            </div>
        </section>
    </main>

    <footer id="footer" class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4>About PAQI</h4>
                    <p>The Pakistan Air Quality Initiative (PAQI) is an independent research and advocacy organization dedicated towards a breathable and healthy Pakistan, with robust scientific insights and data-driven solutions to overcome the air pollution crisis.</p>
                </div>
                <div class="footer-col">
                    <h4>Navigate</h4>
                    <ul>
                        <li><a href="#impact">Impact</a></li>
                        <li><a href="#map">Live Map</a></li>
                        <li><a href="#chart">Data & Charts</a></li>
                        <li><a href="#team">Our Team</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="#blog">Insights</a></li>
                        <li><a href="#">Research Papers</a></li>
                        <li><a href="#">Press Kit</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Let's talk</h4>
                    <p>Get the latest air quality news and health advisories.</p>
                    <form class="footer-subscribe-form">
                        <input type="email" placeholder="Your email">
                        <button type="submit">Go</button>
                    </form>
                    <div class="footer-socials">
                        <a href="https://www.instagram.com/pakairquality/" aria-label="Our Instagram Profile"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.689-.073-4.948-.073zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.88 1.44 1.44 0 000-2.88z"></path></svg></a>
                        <a href="https://x.com/PakAirQuality/" aria-label="Our X Profile"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg></a>
                        <a href="https://www.facebook.com/PakAirQuality/" aria-label="Our Facebook Profile"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.675 0h-21.35C.59 0 0 .59 0 1.325v21.35C0 23.41.59 24 1.325 24H12.82v-9.29H9.692v-3.622h3.128V8.413c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12V24h6.116c.735 0 1.325-.59 1.325-1.325V1.325C24 .59 23.41 0 22.675 0z"></path></svg></a>
                        <a href="https://pk.linkedin.com/company/pakairquality" aria-label="Our LinkedIn Profile"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 114.128 0c0 1.14-.926 2.065-2.065 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.225 0z"></path></svg></a>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 Pakistan Air Quality Initiative (پاکی).</p>
            </div>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Header & Mobile Menu Logic ---
        const header = document.getElementById('main-header');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const desktopNav = document.querySelector('.header-nav');
        
        // Dynamically create mobile menu from desktop nav
        const navLinks = desktopNav.querySelectorAll('a');
        navLinks.forEach(link => {
            const mobileLink = link.cloneNode(true);
            mobileMenu.appendChild(mobileLink);
        });
        const ctaButton = document.querySelector('.header-cta');
        if (ctaButton) {
            const mobileCta = ctaButton.cloneNode(true);
            mobileMenu.appendChild(mobileCta);
        }

        window.addEventListener('scroll', () => {
            header.classList.toggle('header-scrolled', window.scrollY > 50);
        });

        mobileMenuButton.addEventListener('click', (e) => {
            e.stopPropagation();
            mobileMenu.classList.toggle('is-open');
        });
        
        // --- AQI Widget Logic ---
        const aqiWidget = document.getElementById('aqi-widget');
        const aqiValueEl = document.getElementById('aqi-value');
        const aqiCategoryEl = document.getElementById('aqi-category');
        const aqiCityEl = document.getElementById('aqi-city');

        if (aqiWidget) {
            aqiWidget.addEventListener('click', () => {
                aqiWidget.classList.toggle('is-collapsed');
            });
        }

        function getAqiInfo(aqi) {
            if (aqi <= 50) return { category: 'Good', className: 'aqi-good' };
            if (aqi <= 100) return { category: 'Moderate', className: 'aqi-moderate' };
            if (aqi <= 150) return { category: 'Unhealthy (SG)', className: 'aqi-usg' };
            if (aqi <= 200) return { category: 'Unhealthy', className: 'aqi-unhealthy' };
            if (aqi <= 300) return { category: 'Very Unhealthy', className: 'aqi-very-unhealthy' };
            return { category: 'Hazardous', className: 'aqi-hazardous' };
        }

        function fetchAqi(latitude, longitude) {
            const apiUrl = `/api/aqi?lat=${latitude}&lon=${longitude}`;
            fetch(apiUrl)
                .then(response => response.ok ? response.json() : Promise.reject(`API Error: ${response.status}`))
                .then(data => {
                    if (data.status === 'success') {
                        const { aqius } = data.data.current.pollution;
                        const { city } = data.data;
                        const aqiInfo = getAqiInfo(aqius);
                        aqiValueEl.textContent = aqius;
                        aqiValueEl.className = `aqi-value ${aqiInfo.className}`;
                        aqiCategoryEl.textContent = aqiInfo.category;
                        aqiCategoryEl.className = `aqi-category ${aqiInfo.className}`;
                        aqiCityEl.textContent = city;
                    } else { throw new Error('API returned non-success status'); }
                })
                .catch(error => {
                    console.error('Error fetching AQI data:', error);
                    aqiValueEl.textContent = '-';
                    aqiCategoryEl.textContent = 'Unavailable';
                    aqiCityEl.textContent = 'Could not load';
                });
        }

        navigator.geolocation ? navigator.geolocation.getCurrentPosition(
            pos => fetchAqi(pos.coords.latitude, pos.coords.longitude),
            () => { console.error('Geolocation error.'); aqiCityEl.textContent = 'Lahore (Default)'; fetchAqi(31.5204, 74.3587); }
        ) : (aqiCityEl.textContent = 'Lahore (Default)', fetchAqi(31.5204, 74.3587));

        // --- Hero Slider Logic ---
        const slides = [ { id: 'slide-1', title: 'Clearing the Air for a Healthier Pakistan', text: "Air pollution is the nation's leading environmental threat. We are dedicated to providing the data and tools needed to drive change.", button: 'Learn About The Crisis &rarr;', }, { id: 'slide-2', title: 'Data-Driven Action, Real-Time Impact', text: 'Our network of over 100 sensors across Pakistan provides transparent, real-time air quality data to citizens, researchers, and policymakers.', button: 'View Our Live Map &rarr;', }, { id: 'slide-3', title: 'Protecting Our Future Generations', text: 'Every citizen deserves the right to breathe clean air. Our initiatives focus on public health awareness and safeguarding vulnerable communities.', button: 'See Our Impact &rarr;', }, { id: 'slide-4', title: 'A Breath of Fresh Air is Possible', text: 'Through collaborative effort, scientific research, and public engagement, we can build a future with clear skies for Pakistan.', button: 'Get Involved &rarr;', }, ];
        let currentSlide = 0;
        const heroTextContent = document.getElementById('hero-text-content');
        function changeSlide() {
            document.querySelector('.hero-slide.active').classList.remove('active');
            currentSlide = (currentSlide + 1) % slides.length;
            document.getElementById(slides[currentSlide].id).classList.add('active');
            heroTextContent.style.opacity = '0';
            setTimeout(() => {
                const { title, text, button } = slides[currentSlide];
                heroTextContent.innerHTML = `<div class="hero-text-container"><h1>${title}</h1><p>${text}</p><a href="#map" class="cta-button">${button}</a></div>`;
                heroTextContent.style.opacity = '1';
            }, 1000);
        }
        setInterval(changeSlide, 8000);

        // --- General Animation Observer ---
        const animationObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('is-visible'); });
        }, { threshold: 0.1 });
        document.querySelectorAll('.animate-on-scroll').forEach(el => animationObserver.observe(el));
        
        // --- ENHANCEMENT: Reactive Element Logic ---
        // 1. Hero Section Cursor Spotlight
        const heroSection = document.getElementById('hero');
        if (heroSection) {
            heroSection.addEventListener('mousemove', e => {
                const rect = heroSection.getBoundingClientRect();
                heroSection.style.setProperty('--mouse-x', `${e.clientX - rect.left}px`);
                heroSection.style.setProperty('--mouse-y', `${e.clientY - rect.top}px`);
            });
        }
        // 2. AQI Widget Parallax on Scroll (Desktop only)
        if (aqiWidget && window.innerWidth >= 768) {
            window.addEventListener('scroll', () => {
                const scrollOffset = window.scrollY * 0.1;
                aqiWidget.style.transform = `translateY(${scrollOffset}px)`;
            }, { passive: true });
        }
        // 3. Animated "Counting Up" Numbers
        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                let currentValue = Math.floor(progress * (end - start) + start);
                
                if (end >= 1000000) {
                    obj.innerHTML = `${(currentValue / 1000000).toFixed(1)}M+`;
                } else if (end >= 1000) {
                    obj.innerHTML = `${(currentValue / 1000).toFixed(0)}K+`;
                } else {
                    obj.textContent = currentValue.toLocaleString() + '+';
                }

                if (progress < 1) window.requestAnimationFrame(step);
                else { // Ensure final text is accurate
                    if (end >= 1000000) obj.innerHTML = `${(end / 1000000).toFixed(0)}M+`;
                    else if (end >= 1000) obj.innerHTML = `${(end / 1000).toFixed(1)}K+`;
                }
            };
            window.requestAnimationFrame(step);
        }
        const impactObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const el = entry.target;
                    const numberEl = el.querySelector('.impact-item-number');
                    const textContent = numberEl.textContent;
                    let numericTarget = 0;
                    if (textContent.includes('M')) numericTarget = parseFloat(textContent) * 1000000;
                    else if (textContent.includes('K')) numericTarget = parseFloat(textContent) * 1000;
                    else numericTarget = parseInt(textContent.replace(/[^\d]/g, ''));
                    animateValue(numberEl, 0, numericTarget, 2000);
                    impactObserver.unobserve(el);
                }
            });
        }, { threshold: 0.5 });
        document.querySelectorAll('.impact-item').forEach(item => impactObserver.observe(item));
        
        // --- Data for Map & Chart ---
        const chartData = { Lahore: {"2017":196.27,"2018":117.98,"2019":100.02,"2020":83.10,"2021":90.99,"2022":107.97,"2023":105.91,"2024":104.58}, Karachi: {"2017":38.83,"2018":47.92,"2019":37.75,"2020":54.27,"2021":58.19,"2022":48.69,"2023":52.20,"2024":46.22}, Peshawar: {"2017":62.54,"2018":76.79,"2019":64.74,"2020":43.87,"2021":101.25,"2022":95.92,"2023":84.01,"2024":95.78}, Islamabad: {"2017":41.78,"2018":44.07,"2019":42.38,"2020":44.42,"2021":47.00,"2022":41.79,"2023":51.11,"2024":54.41} };
        const cityColors = { Lahore: 'var(--color-lahore)', Karachi: 'var(--color-karachi)', Peshawar: 'var(--color-peshawar)', 'Islamabad': 'var(--color-islamabad)' };

        // --- D3.js Chart Logic ---
        function drawChart() {
            const svg = d3.select("#timeline-chart").html(""); // Clear previous chart
            const margin = {top: 40, right: 20, bottom: 40, left: 50};
            const fullWidth = svg.node().getBoundingClientRect().width;
            let fullHeight = svg.node().getBoundingClientRect().height;
            if (fullHeight <= 0) fullHeight = fullWidth / (800 / 450); // Use viewBox aspect ratio
            const width = fullWidth - margin.left - margin.right;
            const height = fullHeight - margin.top - margin.bottom;
            
            const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);
            const years = Object.keys(Object.values(chartData)[0]);
            const x = d3.scalePoint().range([0, width]).padding(0.5).domain(years);
            const y = d3.scaleLinear().range([height, 0]).domain([0, d3.max(Object.values(chartData).flatMap(Object.values)) * 1.1]);
            const line = d3.line().x(d => x(d.year)).y(d => y(d.value)).curve(d3.curveMonotoneX);
            
            g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x).tickSize(0).tickPadding(15));
            g.append("g").attr("class", "y-axis").call(d3.axisLeft(y).ticks(5).tickSize(-width));
            
            Object.keys(chartData).forEach((city, i) => {
                const data = years.map(year => ({ year: year, value: chartData[city][year] }));
                const path = g.append("path").datum(data).attr("class", "data-line").attr("id", `line-${city}`).attr("d", line).style("stroke", cityColors[city]);
                const pathLength = path.node().getTotalLength();
                path.attr("stroke-dasharray", pathLength).attr("stroke-dashoffset", pathLength);
            });

            d3.select("#chart-legend").html(""); // Clear old legend
            Object.keys(cityColors).forEach(city => {
                d3.select("#chart-legend").append("div").attr("class", "legend-item").attr("data-city", city)
                  .html(`<div class="legend-color" style="background-color: ${cityColors[city]}"></div>${city}`);
            });

            const chartObserver = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting) {
                    g.selectAll(".data-line").transition().duration(2000).ease(d3.easeCubicOut).delay((d, i) => i * 100).attr("stroke-dashoffset", 0);
                    chartObserver.unobserve(entries[0].target);
                }
            }, { threshold: 0.5 });
            chartObserver.observe(svg.node());
            
            d3.selectAll(".legend-item").on("click", function () {
                const city = d3.select(this).attr("data-city");
                const isDimmed = d3.select(this).classed("is-dimmed");
                d3.select(this).classed("is-dimmed", !isDimmed);
                d3.select(`#line-${city}`).classed("is-dimmed", !isDimmed);
            });
        }
        drawChart();
        window.addEventListener('resize', drawChart); // Redraw chart on window resize

        // --- PNG Map Logic ---
        const mapLayer = document.getElementById('map-interactive-layer');
        const mapTooltip = document.getElementById('map-tooltip');
        if (mapLayer) {
            const mapCityData = { 'Islamabad': { top: '30%', left: '68%', aqi: Math.round(chartData['Islamabad']['2024']), color: cityColors['Islamabad'] }, 'Lahore': { top: '45%', left: '72.5%', aqi: Math.round(chartData['Lahore']['2024']), color: cityColors['Lahore'] }, 'Peshawar': { top: '26%', left: '61%', aqi: Math.round(chartData['Peshawar']['2024']), color: cityColors['Peshawar'] }, 'Karachi': { top: '90%', left: '45%', aqi: Math.round(chartData['Karachi']['2024']), color: cityColors['Karachi'] }, };
            Object.entries(mapCityData).forEach(([city, data]) => {
                const marker = document.createElement('div');
                marker.className = 'map-marker';
                marker.dataset.city = city;
                Object.assign(marker.style, { top: data.top, left: data.left, '--marker-color': data.color });
                mapLayer.appendChild(marker);
            });
            mapLayer.addEventListener('mouseover', e => {
                if (!e.target.classList.contains('map-marker')) return;
                const city = e.target.dataset.city;
                const data = mapCityData[city];
                const level = data.aqi > 55 ? 'Unhealthy' : data.aqi > 35 ? 'Unhealthy (SG)' : data.aqi > 5 ? 'Moderate' : 'Good';
                mapTooltip.innerHTML = `<h4>${city}</h4><p>2024 Avg: <span class="aqi-value" style="color:${data.color};">${data.aqi}</span><span class="unit"> µg/m³</span></p><small>${level}</small>`;
                const markerRect = e.target.getBoundingClientRect();
                const mapRect = mapLayer.getBoundingClientRect();
                mapTooltip.style.left = `${markerRect.left - mapRect.left - mapTooltip.offsetWidth / 2 + markerRect.width / 2}px`;
                mapTooltip.style.top = `${markerRect.top - mapRect.top - mapTooltip.offsetHeight - 15}px`;
                mapTooltip.classList.add('is-visible');
            });
            mapLayer.addEventListener('mouseout', e => {
                if (e.target.classList.contains('map-marker')) mapTooltip.classList.remove('is-visible');
            });
        }
    });
    </script>
</body>
</html>